<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

        <style type="text/css">

            path { 
                stroke: teal;
                stroke-width: 2;
                fill: none;
            }

            .axis path,
            .axis line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }

            .axis text {
                font-family: sans-serif;
                font-size: 11px;
            }

            .axisLabel {
                font: Garamond;
                font-size: 14px;
            }

        </style>

    </head>

    <body>
        <script type="text/javascript">

            var dataset;

            var margin = {top: 20, right: 20, bottom: 60, left: 60};
            var w = 800 - margin.left - margin.right;
            var h = 200 - margin.top - margin.bottom;

            var yScale, xScale;
            var xAxis, yAxis;

            // Make the current temperature block
            var currentTemp = d3.select("body")
                .append("p")

            // Make the svg element where the graph will appear
            var svg = d3.select("body")
                .append("svg")
                .attr("width",w + margin.left + margin.right)
                .attr("height",h + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");



            d3.csv("data.csv", 
                function(error, data) {
                    if (error){
                        // Log the error
                        console.log(error);
                    } else {

                        data.forEach(function(d) {
                            d.Time = new Date(d.Time);
                        });

                        dataset = data;
                        setCurrentTemp();
                        generateScales();
                        generateLine();
                        generateAxes();

                    }
                }
            );

            function setCurrentTemp(){
                currentTemp.text("Temperature is: " + dataset[dataset.length - 1].Temperature);
            }

            function generateScales(){

                yScale = d3.scale.linear()
                    .domain([d3.min(dataset, function(d) { return d.Temperature; }) - 1,
                                d3.max(dataset, function(d) { return d.Temperature; })])
                    .range([h, 0])
                    .nice();

                xScale = d3.time.scale()
                    .domain(d3.extent(dataset, function(d) { return d.Time; }))
                    .range([0, w])
                    .nice();

            }

            function generateLine(){

                // Define the line
                var valueline = d3.svg.line()
                    .x(function(d) { return xScale(d.Time); })
                    .y(function(d) { return yScale(d.Temperature); });

                svg.append("path")
                    .attr("class", "line")
                    .attr("d", valueline(dataset));

            }

            function generateAxes(){
                xAxis = d3.svg.axis()
                  .scale(xScale)
                  .orient("bottom");

                svg.append("g")
                    .attr("transform", "translate(0," + h + ")")
                    .attr("class", "axis")
                    .call(xAxis);

                yAxis = d3.svg.axis()
                  .scale(yScale)
                  .orient("left");

                svg.append("g")
                    .attr("transform", "translate(" + 0 + ",0)")
                    .attr("class", "axis")
                    .call(yAxis);

                // Add axis labels
                svg.append("text")
                    .attr("class", "axisLabel")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left)
                    .attr("x", 0 - h/2 )
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text("Temperature (C)");

                svg.append("text")
                    .attr("class", "axisLabel")
                    .attr("x", w/2 )
                    .attr("y",h + margin.bottom )
                    .attr("dy", "-1em")
                    .style("text-anchor", "middle")
                    .text("Time");
            }

            function generateBars(){

                svg.selectAll("rect")
                    .data(dataset)
                    .enter()
                    .append("rect")
                    .attr("x",0)
                    .attr("y",0)
                    .attr("height",h)
                    .attr("width",w / dataset.length - barPadding)
                    .attr("fill", "teal")
                    .attr("y", function(d){
                        return h - yScale(d.Temperature);
                    })
                    .attr("height", function(d,i){
                        console.log(d.Temperature);
                        return yScale(d.Temperature);
                    })
                    .attr("x", function(d,i) {
                        return i*(w/dataset.length);
                    })
                    ;

            };

        </script>
    </body>
</html>